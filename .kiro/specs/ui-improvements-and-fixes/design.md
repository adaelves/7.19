# UI改进和修复设计文档

## 概述

本设计文档针对多平台视频下载器的用户界面改进和功能修复，重点解决macOS风格界面设计、设置保存功能、创作者监控功能以及代码重复清理等关键问题。

## 核心组件设计

### 1. 代码清理和重构

#### 重复文件检测器
- 扫描并删除重复的修复记录文件
- 合并功能相同的代码块
- 移除未使用的导入和函数

### 2. 主界面窗口改进

#### 可拖拽窗口实现
- 实现标题栏拖拽功能
- 添加双击最大化/还原
- macOS风格窗口控制按钮

### 3. 设置保存功能修复

#### 配置管理器重构
- 原子性文件保存
- 批量设置更新
- 错误处理和回滚机制

#### 浏览按钮修复
- **问题分析**：`browse_download_path`方法参数传递错误，导致AttributeError: 'bool' object has no attribute 'text'
- **解决方案**：修复方法调用，确保正确传递QLineEdit对象而非布尔值
- **实现**：重构浏览按钮的信号连接逻辑

### 4. 创作者监控功能完善

#### 监控管理器
- **URL验证器重构**：修复bilibili地址验证逻辑，支持"https://space.bilibili.com/618614606"格式
- **操作列实现**：在表格中添加下载和检测按钮
- **拖拽排序功能**：实现QTableWidget的拖拽重排序
- **右键菜单**：添加"固定到顶部"功能
- **数据列重构**：
  - "新作品"列显示数量而非时间
  - 添加"最后下载时间"列
  - 添加"最后更新时间"列
  - "启用"列用于控制监控开关

### 5. 深色主题和界面设置

#### 主题管理器
- 完整的深色主题样式
- 字体大小和界面缩放
- **透明效果扩展**：将透明效果从仅主界面扩展到历史记录、创作者监控、首选项所有对话框

#### 速度限制功能
- **下载速度控制器**：在下载选项中添加速度限制设置
- **单位支持**：支持KB/s和MB/s单位选择
- **实时监控**：显示当前下载速度和限制状态
- **动态调整**：支持运行时启用/禁用速度限制

### 6. 托盘功能实现

#### 系统托盘管理器
- 托盘图标和菜单
- 最小化到托盘
- 关闭到托盘选项

## 实现策略

### 分阶段实施
1. 代码清理和重构
2. 主界面窗口改进
3. 设置保存功能修复
4. 创作者监控功能完善
5. 深色主题和界面设置
6. 托盘功能实现

### 测试策略
- 每个阶段完成后进行功能测试
- 确保现有功能不受影响
- 进行用户体验测试