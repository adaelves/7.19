# UI改进和修复需求文档

## 介绍

本文档针对多平台视频下载器的用户界面改进和功能修复需求，重点解决macOS风格界面设计、设置保存功能、创作者监控功能以及代码重复清理等关键问题。

## 需求

### 需求 1 - 代码清理和重构

**用户故事：** 作为开发者，我希望清理重复的文件和代码，提高代码质量和维护性。

#### 验收标准

1. WHEN 系统扫描项目文件 THEN 系统 SHALL 识别并删除所有重复的修复记录文件
2. WHEN 系统分析代码 THEN 系统 SHALL 合并功能相同的重复代码块
3. WHEN 系统检查文件 THEN 系统 SHALL 删除未使用的文件和函数
4. WHEN 系统重构代码 THEN 系统 SHALL 保持现有功能不变
5. WHEN 清理完成 THEN 系统 SHALL 生成清理报告

### 需求 2 - 主界面窗口改进

**用户故事：** 作为用户，我希望主界面可以拖拽移动，并具有完整的macOS风格设计。

#### 验收标准

1. WHEN 用户点击标题栏 THEN 系统 SHALL 允许拖拽移动窗口
2. WHEN 用户双击标题栏 THEN 系统 SHALL 切换最大化/还原状态
3. WHEN 系统渲染界面 THEN 系统 SHALL 使用圆角设计风格
4. WHEN 系统显示窗口 THEN 系统 SHALL 实现macOS标准的窗口控制按钮
5. WHEN 用户操作窗口 THEN 系统 SHALL 提供流畅的动画效果

### 需求 3 - macOS风格界面设计

**用户故事：** 作为用户，我希望所有界面元素都采用统一的macOS设计风格。

#### 验收标准

1. WHEN 系统渲染主界面 THEN 系统 SHALL 使用macOS标准的圆角和阴影效果
2. WHEN 系统显示历史记录 THEN 系统 SHALL 采用macOS风格的列表设计
3. WHEN 系统显示设置界面 THEN 系统 SHALL 使用macOS风格的选项卡和控件
4. WHEN 系统显示创作者监控 THEN 系统 SHALL 采用macOS风格的表格设计
5. WHEN 系统应用主题 THEN 系统 SHALL 保持macOS风格的一致性

### 需求 4 - 首选项功能增强

**用户故事：** 作为用户，我希望首选项中有更多的下载配置选项。

#### 验收标准

1. WHEN 用户打开下载设置 THEN 系统 SHALL 提供重试次数调整选项
2. WHEN 用户配置重命名格式 THEN 系统 SHALL 提供自定义格式选择器
3. WHEN 用户选择重命名格式 THEN 系统 SHALL 支持"[artist] title"、"[artist][id] title"等格式
4. WHEN 用户测试代理 THEN 系统 SHALL 显示绿色成功或红色失败的状态文字
5. WHEN 用户配置托盘选项 THEN 系统 SHALL 提供最小化到托盘和关闭到托盘选项

### 需求 5 - 设置保存功能修复

**用户故事：** 作为用户，我希望首选项中的设置能够正确保存并持久化。

#### 验收标准

1. WHEN 用户点击下载路径浏览按钮 THEN 系统 SHALL 打开文件夹选择对话框而不报错
2. WHEN 用户修改设置 THEN 系统 SHALL 正确保存所有更改到配置文件
3. WHEN 用户点击保存按钮 THEN 系统 SHALL 立即持久化设置更改
4. WHEN 用户重新打开设置 THEN 系统 SHALL 显示之前保存的设置值
5. WHEN 系统重启 THEN 系统 SHALL 加载并应用保存的设置
6. WHEN 设置保存失败 THEN 系统 SHALL 显示明确的错误信息

### 需求 6 - 创作者监控功能完善

**用户故事：** 作为用户，我希望创作者监控功能能够正常添加监控并显示详细信息。

#### 验收标准

1. WHEN 用户输入bilibili博主地址"https://space.bilibili.com/618614606" THEN 系统 SHALL 验证地址有效性并成功添加
2. WHEN 用户点击添加监控按钮 THEN 系统 SHALL 成功添加创作者到监控列表而不显示"请输入有效的博主主页地址"错误
3. WHEN 系统显示监控列表 THEN 系统 SHALL 在"操作"列显示下载和检测按钮
4. WHEN 系统显示监控列表 THEN 系统 SHALL 支持鼠标拖拽排列顺序
5. WHEN 用户右键点击监控项 THEN 系统 SHALL 提供"固定到顶部"功能
6. WHEN 系统显示"新作品"列 THEN 系统 SHALL 显示最后下载时间到当前时间更新的作品数量，而不是时间
7. WHEN 系统显示监控列表 THEN 系统 SHALL 包含"最后下载时间"和"最后更新时间"列显示具体时间
8. WHEN 系统显示"启用"列 THEN 系统 SHALL 允许用户启用/禁用特定创作者的监控功能

### 需求 7 - 深色主题和界面设置

**用户故事：** 作为用户，我希望深色主题和其他界面设置能够正常工作。

#### 验收标准

1. WHEN 用户选择深色主题 THEN 系统 SHALL 正确应用深色主题样式
2. WHEN 用户调整字体大小 THEN 系统 SHALL 实时更新界面字体大小
3. WHEN 用户调整界面缩放 THEN 系统 SHALL 按比例缩放所有界面元素
4. WHEN 用户启用透明效果 THEN 系统 SHALL 应用窗口透明和毛玻璃效果到主界面、历史记录、创作者监控和首选项所有对话框
5. WHEN 用户切换设置 THEN 系统 SHALL 立即预览效果并保存设置

### 需求 13 - 下载速度限制功能

**用户故事：** 作为用户，我希望能够限制下载速度以避免占用过多带宽。

#### 验收标准

1. WHEN 用户打开下载选项 THEN 系统 SHALL 提供速度限制设置控件
2. WHEN 用户设置速度限制 THEN 系统 SHALL 支持KB/s和MB/s单位选择
3. WHEN 用户启用速度限制 THEN 系统 SHALL 将下载速度控制在设定范围内
4. WHEN 下载进行中 THEN 系统 SHALL 显示当前下载速度和限制状态
5. WHEN 用户禁用速度限制 THEN 系统 SHALL 恢复最大速度下载

### 需求 8 - 托盘功能实现

**用户故事：** 作为用户，我希望应用支持系统托盘功能。

#### 验收标准

1. WHEN 用户启用托盘功能 THEN 系统 SHALL 在系统托盘显示应用图标
2. WHEN 用户选择最小化到托盘 THEN 系统 SHALL 隐藏窗口并保持托盘图标
3. WHEN 用户选择关闭到托盘 THEN 系统 SHALL 在关闭时最小化到托盘而不退出
4. WHEN 用户右键托盘图标 THEN 系统 SHALL 显示托盘菜单
5. WHEN 用户双击托盘图标 THEN 系统 SHALL 恢复显示主窗口

### 需求 9 - 代理测试状态显示

**用户故事：** 作为用户，我希望代理测试结果有清晰的视觉反馈。

#### 验收标准

1. WHEN 用户测试代理连接 THEN 系统 SHALL 显示测试进度指示器
2. WHEN 代理连接成功 THEN 系统 SHALL 显示绿色的"连接成功"文字
3. WHEN 代理连接失败 THEN 系统 SHALL 显示红色的"连接失败"文字
4. WHEN 测试完成 THEN 系统 SHALL 显示详细的连接信息（延迟、IP等）
5. WHEN 测试超时 THEN 系统 SHALL 显示黄色的"连接超时"提示

### 需求 10 - 创作者监控表格增强

**用户故事：** 作为用户，我希望创作者监控表格提供更丰富的信息和操作。

#### 验收标准

1. WHEN 系统显示监控表格 THEN 系统 SHALL 包含"新作品"数量列
2. WHEN 系统检测更新 THEN 系统 SHALL 实时更新"新作品"数量
3. WHEN 用户查看表格 THEN 系统 SHALL 在每行末尾显示下载按钮
4. WHEN 用户点击下载按钮 THEN 系统 SHALL 自动下载该创作者的所有新作品
5. WHEN 下载完成 THEN 系统 SHALL 重置"新作品"数量为0

### 需求 11 - 重命名格式自定义

**用户故事：** 作为用户，我希望能够自定义文件重命名格式。

#### 验收标准

1. WHEN 用户打开重命名设置 THEN 系统 SHALL 提供预设格式选项
2. WHEN 用户选择格式模板 THEN 系统 SHALL 支持"[artist] title"、"[artist][id] title"等格式
3. WHEN 用户自定义格式 THEN 系统 SHALL 提供格式编辑器和预览功能
4. WHEN 用户保存格式 THEN 系统 SHALL 应用格式到新的下载任务
5. WHEN 系统重命名文件 THEN 系统 SHALL 处理特殊字符和文件名长度限制

### 需求 12 - 重试次数配置

**用户故事：** 作为用户，我希望能够配置下载失败时的重试次数。

#### 验收标准

1. WHEN 用户打开下载设置 THEN 系统 SHALL 提供重试次数调整控件
2. WHEN 用户设置重试次数 THEN 系统 SHALL 支持0-10次的范围选择
3. WHEN 下载失败 THEN 系统 SHALL 按照设置的次数进行自动重试
4. WHEN 重试进行中 THEN 系统 SHALL 显示当前重试次数和剩余次数
5. WHEN 重试全部失败 THEN 系统 SHALL 标记任务为失败状态